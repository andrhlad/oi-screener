<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto World Dashboard</title>

<style>
:root {
  --bg:#f7f7f9;
  --card-bg:#fff;
  --border:#e4e6ef;
  --text-main:#222;
  --text-muted:#8f95a3;
  --green:#16a34a;
  --red:#dc2626;
  --radius:14px;
  --shadow:0 8px 20px rgba(15,23,42,.06);
  --accent:#f7a600; /* Bybit accent */
}
[data-theme="dark"] {
  --bg:#0b0e11;
  --card-bg:#161a1e;
  --border:#23282f;
  --text-main:#eaecef;
  --text-muted:#848e9c;
  --shadow:0 8px 20px rgba(0,0,0,.4);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{background:var(--bg);color:var(--text-main)}

.header{background:var(--card-bg);border-bottom:1px solid var(--border);position:sticky;top:0}
.header-inner{max-width:1440px;margin:auto;padding:12px 24px;display:flex;justify-content:space-between}
.logo{font-weight:800;color:var(--accent)}

.dashboard{
  display:grid;
  grid-template-columns:350px 1fr 320px;
  max-width:1440px;
  margin:20px auto;
  padding:0 20px 40px;
  gap:20px
}
.column{display:flex;flex-direction:column;gap:20px}
.card{
  background:var(--card-bg);
  border-radius:var(--radius);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  padding:16px
}
.card-title{
  font-size:12px;
  font-weight:700;
  color:var(--text-muted);
  margin-bottom:10px;
  text-transform:uppercase
}

.chat-container{overflow-y:auto;display:flex;flex-direction:column;gap:6px}
.small-box{height:180px}
.mid-box{height:300px}
.large-box{height:500px}

.chat-item{
  padding:8px;
  font-size:12px;
  border-left:3px solid;
  background:rgba(255,255,255,.02)
}
.is-up{border-color:var(--green)}
.is-down{border-color:var(--red)}

.leader-row{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  font-size:13px;
  padding:6px 0;
  border-bottom:1px solid var(--border);
  align-items:center
}
.leader-row:last-child{border-bottom:none}
.price{text-align:right;color:var(--text-muted)}
.up{color:var(--green);text-align:right}
.down{color:var(--red);text-align:right}

@media(max-width:1100px){
.dashboard{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header class="header">
  <div class="header-inner">
    <div class="logo">CRYPTO WORLD</div>
    <button id="theme-btn">üåì</button>
  </div>
</header>

<main class="dashboard">

<!-- LEFT -->
<div class="column">
  <div class="card">
    <div class="card-title">–ù–æ–≤–∏–Ω–∏ Live</div>
    <div id="news-container" class="chat-container small-box"></div>
  </div>
  <div class="card">
    <div class="card-title">–î–µ–ª—ñ—Å—Ç–∏–Ω–≥ / –õ—ñ—Å—Ç–∏–Ω–≥</div>
    <div id="listings-container" class="chat-container small-box"></div>
  </div>
  <div class="card">
    <div class="card-title">–ü–∞–º–ø & –î–∞–º–ø</div>
    <div id="pump-chat" class="chat-container large-box"></div>
  </div>
</div>

<!-- CENTER -->
<div class="column">
  <div class="card">
    <div class="card-title">Open Interest</div>
    <div id="oi-chat" class="chat-container mid-box"></div>
  </div>
  <div class="card">
    <div class="card-title">–õ—ñ–∫–≤—ñ–¥–∞—Ü—ñ—ó</div>
    <div id="liquidations-chat" class="chat-container large-box"></div>
  </div>
</div>

<!-- RIGHT -->
<div class="column">
  <div class="card">
    <div class="card-title">–¢–æ–ø –ì–µ–π–Ω–µ—Ä–∏ (24–≥)</div>
    <div id="gainers-list"></div>
  </div>
  <div class="card">
    <div class="card-title">–¢–æ–ø –õ—É–∑–µ—Ä–∏ (24–≥)</div>
    <div id="losers-list"></div>
  </div>
</div>

</main>

<script>
const API_URL="http://127.0.0.1:5000";

/* THEME */
document.getElementById("theme-btn").onclick=()=>{
  const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";
  document.documentElement.setAttribute("data-theme",t);
}

/* CHAT */
function processMessage(text){
  const el=document.createElement("div");
  el.className=`chat-item ${/DUMP|üìâ/.test(text)?"is-down":"is-up"}`;
  el.innerHTML=text;
  pump-chat.prepend(el);
}

/* LEADERS */
function formatPrice(p){
  if(p>1000)return p.toFixed(2);
  if(p>1)return p.toFixed(4);
  return p.toFixed(6);
}

function renderLeaders(id,list){
  document.getElementById(id).innerHTML=list.map(i=>`
    <div class="leader-row">
      <div>${i.symbol}</div>
      <div class="price">$${formatPrice(i.price)}</div>
      <div class="${i.change>=0?'up':'down'}">
        ${i.change>=0?'+':''}${i.change}%
      </div>
    </div>
  `).join("");
}

function setupLeadersSSE(){
  const s=new EventSource(API_URL+"/leaders_stream");
  s.onmessage=e=>{
    const d=JSON.parse(e.data);
    renderLeaders("gainers-list",d.gainers);
    renderLeaders("losers-list",d.losers);
  };
  s.onerror=()=>{s.close();setTimeout(setupLeadersSSE,5000);}
}
setupLeadersSSE();
</script>

</body>
</html>
