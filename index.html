<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto World Dashboard</title>
  <style>
    :root {
      --bg: #f7f7f9;
      --card-bg: #ffffff;
      --border: #e4e6ef;
      --text-main: #222;
      --text-muted: #8f95a3;
      --green: #16a34a;
      --red: #dc2626;
      --radius: 14px;
      --shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      --accent: #4f46e5;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --border: #334155;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui, -apple-system, sans-serif; transition: background 0.3s, border-color 0.3s, color 0.3s; }
    body { background: var(--bg); color: var(--text-main); min-height: 100vh; }

    .header { background: var(--card-bg); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
    .header-inner { max-width: 1440px; margin: 0 auto; padding: 12px 24px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-weight: 700; font-size: 20px; color: var(--accent); }
    
    .header-right { display: flex; align-items: center; gap: 15px; }
    .clock-box { background: var(--bg); padding: 8px 16px; border-radius: 99px; font-size: 13px; border: 1px solid var(--border); display: flex; align-items: center; }
    .clock-segment { display: flex; align-items: center; gap: 6px; }
    .clock-label { color: var(--text-muted); font-size: 10px; font-weight: 700; text-transform: uppercase; }
    .clock-time { font-weight: 600; font-variant-numeric: tabular-nums; }

    .theme-toggle { background: var(--bg); border: 1px solid var(--border); color: var(--text-main); width: 38px; height: 38px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }

    .dashboard { display: grid; grid-template-columns: 350px 1fr 320px; max-width: 1440px; margin: 20px auto; padding: 0 20px 40px; gap: 20px; }
    .column { display: flex; flex-direction: column; gap: 20px; }
    
    .card { background: var(--card-bg); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); padding: 16px; display: flex; flex-direction: column; }
    .card-title { font-size: 14px; font-weight: 700; margin-bottom: 12px; text-transform: uppercase; color: var(--text-muted); }
    
    .chat-container { overflow-y: auto; display: flex; flex-direction: column; gap: 8px; scroll-behavior: smooth; }
    .small-box { height: 180px; }
    .mid-box { height: 300px; }
    .large-box { height: 500px; }

    .chat-item { padding: 10px; background: var(--bg); border-radius: 10px; border: 1px solid var(--border); font-size: 12px; line-height: 1.4; border-left: 4px solid #cbd5e1; animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    
    .is-up { border-left-color: var(--green); background: rgba(22, 163, 74, 0.05); }
    .is-down { border-left-color: var(--red); background: rgba(220, 38, 38, 0.05); }
    
    .leaders-content { font-size: 12px; line-height: 1.8; }
    .contact-link { color: var(--accent); text-decoration: none; font-weight: 600; display: block; margin-top: 5px; font-size: 13px; }

    @media (max-width: 1100px) { .dashboard { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-inner">
      <div class="logo">CRYPTO WORLD</div>
      <div class="header-right">
        <div class="clock-box">
          <div class="clock-segment">
            <span class="clock-label">UTC Time</span>
            <span id="clock-utc" class="clock-time">00:00:00</span>
          </div>
        </div>
        <button id="theme-btn" class="theme-toggle">üåì</button>
      </div>
    </div>
  </header>

  <main class="dashboard">
    <div class="column">
      <div class="card">
        <div class="card-title">–ù–æ–≤–∏–Ω–∏ Live</div>
        <div id="news-container" class="chat-container small-box"></div>
      </div>
      <div class="card">
        <div class="card-title">–î–µ–ª—ñ—Å—Ç–∏–Ω–≥ / –õ—ñ—Å—Ç–∏–Ω–≥</div>
        <div id="listings-container" class="chat-container small-box"></div>
      </div>
      <div class="card">
        <div class="card-title">–ü–∞–º–ø & –î–∞–º–ø Live</div>
        <div id="pump-chat" class="chat-container large-box"></div>
      </div>
    </div>

    <div class="column">
      <div class="card">
        <div class="card-title">Open Interest Chat</div>
        <div id="oi-chat" class="chat-container mid-box"></div>
      </div>
      <div class="card" style="flex-grow: 1;">
        <div class="card-title">–õ—ñ–∫–≤—ñ–¥–∞—Ü—ñ—ó Live</div>
        <div id="liquidations-chat" class="chat-container" style="height: 100%; min-height: 400px;"></div>
      </div>
    </div>

    <div class="column">
      <div class="card">
        <div class="card-title">–¢–æ–ø –ì–µ–π–Ω–µ—Ä–∏ (24–≥)</div>
        <div id="gainers-list" class="leaders-content">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
      </div>

      <div class="card">
        <div class="card-title">–¢–æ–ø –õ—É–∑–µ—Ä–∏ (24–≥)</div>
        <div id="losers-list" class="leaders-content">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
      </div>

      <div class="card">
        <div class="card-title">–ü—Ä–æ –Ω–∞—Å</div>
        <div style="font-size: 13px; color: var(--text-muted); line-height: 1.5; margin-bottom: 15px;">
          –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏–ø—Ç–æ-—Ä–∏–Ω–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ. –î–∞–Ω—ñ –ø—Ä–æ –∞–Ω–æ–º–∞–ª—å–Ω—ñ –æ–±'—î–º–∏, –∑–º—ñ–Ω–∏ OI —Ç–∞ –ª—ñ–∫–≤—ñ–¥–∞—Ü—ñ—ó.
        </div>
        <div class="card-title" style="font-size: 11px; margin-bottom: 5px;">–ö–æ–Ω—Ç–∞–∫—Ç–∏</div>
        <a href="mailto:support@cryptoworld.com" class="contact-link">üìß support@cryptoworld.com</a>
        <a href="https://t.me/crypto_world_admin" target="_blank" class="contact-link">‚úàÔ∏è Telegram: @crypto_world_admin</a>
      </div>
    </div>
  </main>

  <script>
    const API_URL = "http://127.0.0.1:5000";

    // –¢–µ–º–∞
    const themeBtn = document.getElementById('theme-btn');
    const toggleTheme = () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
      themeBtn.textContent = isDark ? 'üåì' : '‚òÄÔ∏è';
    };
    
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      themeBtn.textContent = '‚òÄÔ∏è';
    }
    themeBtn.addEventListener('click', toggleTheme);

    // –ì–æ–¥–∏–Ω–Ω–∏–∫ (–¢—ñ–ª—å–∫–∏ UTC)
    function updateClocks() {
      const now = new Date();
      document.getElementById('clock-utc').textContent = now.toLocaleTimeString('uk-UA', { timeZone: 'UTC' });
    }
    setInterval(updateClocks, 1000);
    updateClocks();

    // –û–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–í–°–ï –π–¥–µ –≤ pump-chat)
    function processMessage(text, isHistory = false) {
      const container = document.getElementById('pump-chat');
      if (!container) return;
      
      const div = document.createElement('div');
      const isDown = /üî¥|DUMP|üìâ/.test(text);
      div.className = `chat-item ${isDown ? 'is-down' : 'is-up'}`;
      div.innerHTML = text;

      if (isHistory) {
        container.appendChild(div);
      } else {
        container.prepend(div);
      }

      if (container.children.length > 100) {
        container.removeChild(isHistory ? container.firstChild : container.lastChild);
      }
      
      if (isHistory) {
        container.scrollTop = container.scrollHeight;
      }
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ–¥–µ—Ä—ñ–≤
    async function refreshLeaders() {
      try {
        const [g, l] = await Promise.all([
          fetch(`${API_URL}/gainers`),
          fetch(`${API_URL}/losers`)
        ]);
        document.getElementById('gainers-list').innerHTML = await g.text();
        document.getElementById('losers-list').innerHTML = await l.text();
      } catch (e) { console.error("Update error"); }
    }

    window.onload = () => {
      refreshLeaders();
      setInterval(refreshLeaders, 30000);

      // –Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ SSE –±—ñ–ª—å—à–µ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è
    };
  </script>
</body>
</html>
