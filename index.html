<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Crypto World</title>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: sans-serif;
            overflow-x: hidden;
        }

        .page-wrap {
            min-height: 300vh;
            position: relative;
        }

        section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero {
            background: url("img/color3.png") no-repeat center / cover;
        }

        .repeat {
            background: url("img/color4.png") no-repeat center / cover;
        }

        .extra {
            background: url("img/color3.png") no-repeat center / cover;
        }

        /* ===== –õ–Ü–í–ò–ô –ß–ê–¢ (Pump&Dump) ===== */
        #tg-chat {
            position: fixed;
            top: 350px;
            left: 20px;
            width: 260px;
            height: 360px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #2CC7BD80;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            z-index: 100;
            backdrop-filter: blur(6px);
        }

        #tg-chat-header {
            background: #2CC7BD;
            color: #fff;
            font-weight: bold;
            padding: 10px;
            text-align: center;
            border-radius: 14px 14px 0 0;
            font-size: 14px;
        }

        #tg-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 13px;
            background-image: url("img/25.jpg");
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-color: rgba(255, 255, 255, 0.29);
            background-blend-mode: screen;
        }

        .bot-msg {
            background: rgba(11, 15, 28, 0.58);
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 6px;
            white-space: pre-wrap;
            border-left: 3px solid #2CC7BD;
        }

        .exchange-name {
            font-weight: 700;
        }

        .exchange-name.binance {
            color: #F3BA2F;
        }

        .exchange-name.bybit {
            color: #ffffff;
        }

        .exchange-name a,
        .exchange-name a:visited {
            color: inherit;
            text-decoration: none;
        }

        .coinglass-link,
        .coinglass-link:visited {
            color: #ffffff;
            text-decoration: none;
        }

        /* ===== –ü–†–ê–í–ò–ô –í–ï–†–•–ù–Ü–ô –ß–ê–¢ (Gainers) ===== */
        #leaders-chat {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 320px;
            max-height: 260px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #2CC7BD80;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            z-index: 110;
            backdrop-filter: blur(6px);
            font-size: 13px;
        }

        #leaders-header {
            background: linear-gradient(135deg, #00FF88, #2CC7BD);
            color: #fff;
            font-weight: bold;
            padding: 10px;
            text-align: center;
            border-radius: 14px 14px 0 0;
            font-size: 14px;
        }

        #leaders-messages,
        #leaders-messages a {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            white-space: pre;
            background: rgba(0, 0, 0, 0.4);
            font-family: "Courier New", monospace;
            font-size: 13px;
            color: #00FF88;
            text-decoration: none;
        }

        #leaders-messages a:hover {
            text-decoration: underline;
            color: #00CC66;
        }

        /* ===== –ü–†–ê–í–ò–ô –ù–ò–ñ–ù–Ü–ô –ß–ê–¢ (Decliners) ===== */
        #decliners-chat {
            position: fixed;
            top: 300px;
            right: 20px;
            width: 320px;
            max-height: 260px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #FF475780;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            z-index: 110;
            backdrop-filter: blur(6px);
            font-size: 13px;
        }

        #decliners-header {
            background: linear-gradient(135deg, #FF4757, #FF6B7A);
            color: #fff;
            font-weight: bold;
            padding: 10px;
            text-align: center;
            border-radius: 14px 14px 0 0;
            font-size: 14px;
        }

        #decliners-messages,
        #decliners-messages a {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            white-space: pre;
            background: rgba(0, 0, 0, 0.4);
            font-family: "Courier New", monospace;
            font-size: 13px;
            color: #FF4757;
            text-decoration: none;
        }

        #decliners-messages a:hover {
            text-decoration: underline;
            color: #FF3333;
        }

        /* ===== –°–ü–û–õ–£–ß–ï–ù–ù–Ø –ß–ê–¢–Ü–í ===== */
        #leaders-chat::after,
        #decliners-chat::after {
            content: '';
            position: absolute;
            top: 270px;
            left: 50%;
            width: 60px;
            height: 20px;
            background: linear-gradient(90deg, #2CC7BD, #FF4757);
            transform: translateX(-50%);
            border-radius: 10px;
            z-index: 120;
        }
    </style>
</head>

<body>
<div class="page-wrap">
    <section class="hero">
        <h1>Crypto World</h1>
    </section>
    <section class="repeat"></section>
    <section class="extra"></section>

    <!-- –õ—ñ–≤–∏–π Pump&Dump —á–∞—Ç -->
    <div id="tg-chat">
        <div id="tg-chat-header">üî• Pump&Dump Signals</div>
        <div id="tg-chat-messages">Connecting...</div>
    </div>

    <!-- –ü—Ä–∞–≤–∏–π –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Ç (Gainers) -->
    <div id="leaders-chat">
        <div id="leaders-header">üöÄ Top 10 Gainers 24h</div>
        <div id="leaders-messages">Loading gainers...</div>
    </div>

    <!-- –ü—Ä–∞–≤–∏–π –Ω–∏–∂–Ω—ñ–π —á–∞—Ç (Decliners) -->
    <div id="decliners-chat">
        <div id="decliners-header">üìâ Top 10 Decliners 24h</div>
        <div id="decliners-messages">Loading decliners...</div>
    </div>
</div>

<script>
    // ===== –õ–Ü–í–ò–ô –ß–ê–¢: Pump&Dump Signals =====
    const chat = document.getElementById("tg-chat-messages");
    let lastId = 0;

    function addMessage(msg) {
        if (!msg || msg.id <= lastId) return;
        lastId = msg.id;

        const div = document.createElement("div");
        div.className = "bot-msg";
        div.innerHTML = msg.text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    async function loadHistory() {
        try {
            const r = await fetch("http://127.0.0.1:5000/history?hours=36");
            if (!r.ok) throw new Error("HTTP " + r.status);
            const data = await r.json();
            chat.innerHTML = "";
            data.forEach(addMessage);
        } catch (e) {
            console.error("History load error:", e);
            chat.innerHTML = "Error loading history...";
        }
    }

    function subscribeSignals() {
        const es = new EventSource("http://127.0.0.1:5000/signals");
        es.onmessage = (e) => {
            try {
                addMessage(JSON.parse(e.data));
            } catch (err) {
                console.error("SSE parse error:", err);
            }
        };
        es.onerror = () => {
            es.close();
            setTimeout(subscribeSignals, 3000);
        };
        return es;
    }

    // ===== –ü–†–ê–í–ò–ô –í–ï–†–•–ù–Ü–ô: Gainers =====
    const leadersBox = document.getElementById("leaders-messages");
    async function loadGainers() {
        try {
            const r = await fetch("http://127.0.0.1:5000/gainers");
            if (!r.ok) throw new Error("HTTP " + r.status);
            leadersBox.innerHTML = await r.text();
        } catch (e) {
            console.error("Gainers error:", e);
            leadersBox.textContent = "Error loading gainers‚Ä¶";
        }
    }

    // ===== –ü–†–ê–í–ò–ô –ù–ò–ñ–ù–Ü–ô: Decliners =====
    const declinersBox = document.getElementById("decliners-messages");
    async function loadLosers() {
        try {
            const r = await fetch("http://127.0.0.1:5000/losers");
            if (!r.ok) throw new Error("HTTP " + r.status);
            declinersBox.innerHTML = await r.text();
        } catch (e) {
            console.error("Losers error:", e);
            declinersBox.textContent = "Error loading decliners‚Ä¶";
        }
    }

    // ===== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø =====
    window.addEventListener('load', () => {
        loadHistory();
        subscribeSignals();
        loadGainers();
        loadLosers();
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ–¥–µ—Ä—ñ–≤ –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            loadGainers();
            loadLosers();
        }, 10000);
    });

    // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –º–µ—Ä–µ–∂—ñ
    window.addEventListener('online', () => {
        location.reload();
    });
</script>
</body>
</html>
