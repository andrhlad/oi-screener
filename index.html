<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto World Dashboard</title>

  <style>
    :root {
      --bg: #f7f7f9;
      --card-bg: #ffffff;
      --border: #e4e6ef;
      --text-main: #222;
      --text-muted: #8f95a3;
      --green: #16a34a;
      --red: #dc2626;
      --radius: 14px;
      --shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      --accent: #4f46e5;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --border: #334155;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --shadow: 0 8px 20px rgba(0,0,0,0.25);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text-main);
      min-height: 100vh;
    }

    .header {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-inner {
      max-width: 1440px;
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-weight: 800;
      font-size: 20px;
      color: var(--accent);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .clock-box {
      background: var(--bg);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      border: 1px solid var(--border);
    }

    .theme-toggle {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--bg);
      cursor: pointer;
      font-size: 18px;
    }

    .dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      max-width: 1440px;
      margin: 20px auto;
      padding: 0 20px 40px;
      gap: 20px;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 12px;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .leader-row {
      display: grid;
      grid-template-columns: 1fr 1.2fr 1fr;
      gap: 6px;
      padding: 6px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      font-weight: 600;
    }

    .leader-row:last-child {
      border-bottom: none;
    }

    .leader-price {
      text-align: right;
      color: var(--text-muted);
      font-variant-numeric: tabular-nums;
    }

    .leader-change.up {
      color: var(--green);
      text-align: right;
    }

    .leader-change.down {
      color: var(--red);
      text-align: right;
    }

    @media (max-width: 1100px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

<header class="header">
  <div class="header-inner">
    <div class="logo">CRYPTO WORLD</div>
    <div class="header-right">
      <div class="clock-box">
        UTC: <span id="clock-utc">00:00:00</span>
      </div>
      <button id="theme-btn" class="theme-toggle">üåì</button>
    </div>
  </div>
</header>

<main class="dashboard">
  <div class="column"></div>

  <div class="column">
    <div class="card">
      <div class="card-title">–¢–æ–ø –ì–µ–π–Ω–µ—Ä–∏ (24–≥)</div>
      <div id="gainers-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>
    </div>

    <div class="card">
      <div class="card-title">–¢–æ–ø –õ—É–∑–µ—Ä–∏ (24–≥)</div>
      <div id="losers-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>
    </div>
  </div>

  <div class="column"></div>
</main>

<script>
const API_URL = "http://127.0.0.1:5000";

/* ---------- –¢–ï–ú–ê ---------- */
const themeBtn = document.getElementById("theme-btn");

function setTheme(theme) {
  document.documentElement.setAttribute("data-theme", theme);
  localStorage.setItem("theme", theme);
  themeBtn.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåì";
}

setTheme(localStorage.getItem("theme") || "light");

themeBtn.onclick = () => {
  const current = document.documentElement.getAttribute("data-theme");
  setTheme(current === "dark" ? "light" : "dark");
};

/* ---------- UTC CLOCK ---------- */
setInterval(() => {
  document.getElementById("clock-utc").textContent =
    new Date().toLocaleTimeString("uk-UA", { timeZone: "UTC" });
}, 1000);

/* ---------- LEADERS SSE ---------- */
function formatPrice(p) {
  if (p > 1000) return p.toFixed(2);
  if (p > 1) return p.toFixed(4);
  return p.toFixed(6);
}

function renderLeaders(containerId, items) {
  const el = document.getElementById(containerId);
  el.innerHTML = items.map(i => `
    <div class="leader-row">
      <div>${i.symbol}</div>
      <div class="leader-price">$${formatPrice(i.price)}</div>
      <div class="leader-change ${i.change >= 0 ? 'up' : 'down'}">
        ${i.change >= 0 ? '+' : ''}${i.change}%
      </div>
    </div>
  `).join("");
}

function setupLeadersSSE() {
  const source = new EventSource(`${API_URL}/leaders_stream`);

  source.onmessage = (e) => {
    const data = JSON.parse(e.data);
    renderLeaders("gainers-list", data.gainers);
    renderLeaders("losers-list", data.losers);
  };

  source.onerror = () => {
    source.close();
    setTimeout(setupLeadersSSE, 5000);
  };
}

setupLeadersSSE();
</script>

</body>
</html>
