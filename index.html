<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Crypto World</title>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: sans-serif;
            overflow-x: hidden;
        }

        .page-wrap {
            min-height: 300vh;
            position: relative;
        }

        section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero {
            background: url("img/color3.png") no-repeat center / cover;
        }

        .repeat {
            background: url("img/color4.png") no-repeat center / cover;
        }

        .extra {
            background: url("img/color3.png") no-repeat center / cover;
        }

        /* ===== ЧАТ (Telegram-подібний) ===== */

        #tg-chat {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            width: 260px;
            height: 360px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffcc80;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            z-index: 100;
            backdrop-filter: blur(6px);
        }

        #tg-chat-header {
            background: #9933ff;
            color: #fff;
            font-weight: bold;
            padding: 10px;
            text-align: center;
            border-radius: 14px 14px 0 0;
            font-size: 14px;
        }

        #tg-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 13px;

            /* ФОН ЧАТУ = картинка chat.jpg */
            background-image: url("img/chat.jpg");
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;

            /* освітлюємо картинку, але залишаємо її */
            background-color: rgba(255, 255, 255, 0.29);
            background-blend-mode: screen;
        }

        /* Стилі для повідомлень */
        .bot-msg {
            background: rgba(11, 15, 28, 0.7);
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 6px;
            white-space: pre-wrap;
            border-left: 3px solid #9933ff;
        }

        /* Назви бірж */
        .exchange-name {
            font-weight: 700;
        }

        .exchange-name.binance {
            color: #F3BA2F; /* офіційний жовтий Binance */
        }

        .exchange-name.bybit {
            color: #ffffff; /* білий для Bybit */
        }
    </style>
</head>

<body>
<div class="page-wrap">

    <section class="hero">
        <h1>Crypto World</h1>
    </section>

    <section class="repeat"></section>
    <section class="extra"></section>

    <div id="tg-chat">
        <div id="tg-chat-header">Pump&Dump</div>
        <div id="tg-chat-messages"></div>
    </div>

</div>

<script>
    const chat = document.getElementById("tg-chat-messages");
    let lastId = 0;

    // msg.text тепер має містити span з класами exchange-name binance/bybit
    // наприклад:
    // "<span class='exchange-name binance'>BINANCE</span> AIXBT +2.04% over 10 m"

    function addMessage(msg) {
        if (!msg || msg.id <= lastId) return;
        lastId = msg.id;

        const div = document.createElement("div");
        div.className = "bot-msg";
        div.innerHTML = msg.text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    async function loadHistory() {
        const r = await fetch("http://127.0.0.1:5000/history?hours=36");
        const data = await r.json();
        chat.innerHTML = "";
        data.forEach(addMessage);
    }

    function subscribe() {
        const es = new EventSource("http://127.0.0.1:5000/signals");

        es.onmessage = (e) => {
            try {
                addMessage(JSON.parse(e.data));
            } catch {}
        };

        es.onerror = () => {
            es.close();
            setTimeout(subscribe, 3000);
        };
    }

    loadHistory().then(subscribe);
</script>
</body>
</html>
